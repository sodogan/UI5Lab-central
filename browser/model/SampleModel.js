sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,i){"use strict";return t.extend("ui5lab.browser.model.SampleModel",{constructor:function(e){this._oResourceBundle=e.getResourceBundle();t.apply(this,arguments);this.setSizeLimit(1e4);this._iStartTime=(new Date).getTime();this._loadLibraries();return this},loaded:function(){if(!this._oSamplesLoadedPromise){this._oSamplesLoadedPromise=new Promise(function(e,t){this._fnSamplesLoadedResolve=e;this._fnSamplesLoadedReject=t}.bind(this))}return this._oSamplesLoadedPromise},_loadLibraries:function(){fetch(sap.ui.require.toUrl("ui5lab/browser/libraries.json")).then(function(e){return e.json()}).then(this._loadMetadata.bind(this)).then(this._onMetadataLoaded.bind(this)).catch(this._onError.bind(this))},_loadMetadata:function(e){return new Promise(function(t,s){const a=e.libraries;this._oMetadata={};this._iLibraryCount=a.length;this._iLibraryLoadedCount=0;if(a.length>0){for(let e=0;e<a.length;e++){if(typeof a[e]==="string"){this._loadSamples(a[e],t)}else{const i=Object.keys(a[e])[0];this._oMetadata[i]=a[e][i];this._iLibraryLoadedCount++;if(this._iLibraryCount===this._iLibraryLoadedCount){t()}}}}else{i.information(this._oResourceBundle.getText("noLibrariesConfigured"))}}.bind(this))},_loadSamples:function(t,i,s){var a=sap.ui.require.toUrl("libs/"+t.replace(/\./g,"/")+"/index.json");jQuery.ajax({url:a,dataType:"json",success:function(e){this._oMetadata[t]=e[t];this._iLibraryLoadedCount++}.bind(this),error:function(){e.warning(this._oResourceBundle.getText("noMetadataForLibrary",t));this._iLibraryCount--}.bind(this),complete:function(){if(this._iLibraryCount===this._iLibraryLoadedCount){i()}}.bind(this)})},_onMetadataLoaded:function(){e.info("SampleModel: Loaded all samples in "+((new Date).getTime()-this._iStartTime)+" ms");var t=this._processMetadata(this._oMetadata);this.setProperty("/",t);this.updateBindings(true);this._fnSamplesLoadedResolve()},_processMetadata:function(e){var t={libraries:[],assets:[],samples:[]},i=e;var i=Object.keys(i);for(var s=0;s<i.length;s++){e[i[s]].id=i[s];t.libraries.push(e[i[s]]);var a=Object.keys(e[i[s]].content);for(var r=0;r<a.length;r++){var o=e[i[s]].content[a[r]];o.id=i[s]+"."+o.id;o.library=i[s];t.assets.push(o);for(var n=0;n<o.samples.length;n++){var d=o.samples[n];d.id=o.id+"."+d.id;d.asset=o.id;d.library=i[s];t.samples.push(d)}}}return t},_onError:function(e){e.error="Failed to load the metadata, check for parse errors";this.fireRequestFailed({response:e});this._fnSamplesLoadedReject()}})});